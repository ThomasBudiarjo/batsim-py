

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Shutdown &mdash; Batsim-py 1.0.5 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="DVFS" href="dvfs.html" />
    <link rel="prev" title="Scheduling" href="scheduling.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Batsim-py
          

          
          </a>

          
            
            
              <div class="version">
                1.0.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="scheduling.html">Scheduling</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Shutdown</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#1.-Simulation-Inputs">1. Simulation Inputs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#1.1.-Platform-Description">1.1. Platform Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#1.2.-Workload-Description">1.2. Workload Description</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#2.-Shutdown-Policy">2. Shutdown Policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="#3.-Simulation-Process">3. Simulation Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="#4.-Results-Discussion">4. Results Discussion</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Next-Steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dvfs.html">DVFS</a></li>
</ul>
<p class="caption"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api_doc/simulator.html">Simulator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_doc/events.html">Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_doc/monitors.html">Monitors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_doc/jobs.html">Jobs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_doc/resources.html">Resources</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Batsim-py</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Shutdown</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorials/shutdown.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    min-width: 5ex;
    padding-top: 0.3rem;
    padding-right: 0.3rem;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 0.3rem;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Shutdown">
<h1>Shutdown<a class="headerlink" href="#Shutdown" title="Permalink to this headline">¶</a></h1>
<p>The Shutdown Problem consists of determining the moments to switch off resources in order to save energy. Idle resources consume non-negligible amounts of energy that can be minimized by simply turning them off but the energy/time required to switch On-Off resources can be costly. Therefore, the shutdown policy must balance between performance and energy efficiency.</p>
<p>The objective of this tutorial is to demonstrate how a shutdown policy can be evaluated with Batsim through Batsim-py. It’s organized in the following manner. <a class="reference external" href="#1.-Simulation-Inputs">Section 1</a> presents the simulation input (platform and workload). <a class="reference external" href="#2.-Shutdown-Policy">Section 2</a> details the shutdown policy implementation. <a class="reference external" href="#3.-Simulation-Process">Section 3</a> presents the simulation process. Lastly, <a class="reference external" href="#4.-Results-Discussion">Section 4</a> presents the results and discusses the advantages
of each shutdown policy evaluated.</p>
<div class="section" id="1.-Simulation-Inputs">
<h2>1. Simulation Inputs<a class="headerlink" href="#1.-Simulation-Inputs" title="Permalink to this headline">¶</a></h2>
<p>To evaluate the shutdown policy performance, we must define a platform and a workload. The platform describes the network and resource characteristics (performance, energy consumption, …). The workload describes job characteristics that will simulate user behavior. Optionally, we can also define some external events to setup when machines become unavailable/available but this isn’t necessary and won’t be discussed here.</p>
<div class="admonition note">
<p class="admonition-title fa fa-exclamation-circle"><strong>Note</strong></p>
<p>To fully understand the platform description, you are encouraged to read the <a class="reference external" href="https://simgrid.org/doc/latest/XML_Reference.html#platform-reference">Simgrid documentation</a>. Information about the workload description can be found in <a class="reference external" href="https://batsim.readthedocs.io/en/latest/input-workload.html">Batsim documentation</a>.</p>
</div>
<div class="section" id="1.1.-Platform-Description">
<h3>1.1. Platform Description<a class="headerlink" href="#1.1.-Platform-Description" title="Permalink to this headline">¶</a></h3>
<p>For this tutorial, we define a simple platform with 2 computing resources (hosts) without networking and storage. Moreover, for each host we define 4 power states. These power states will be used to estimate the energy consumption while a host is: off, switching on, switching off, idle, or computing.</p>
<div class="highlight-XML notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&#39;1.0&#39;?&gt;</span>
<span class="cp">&lt;!DOCTYPE platform SYSTEM &quot;http://simgrid.gforge.inria.fr/simgrid/simgrid.dtd&quot;&gt;</span>
<span class="nt">&lt;platform</span> <span class="na">version=</span><span class="s">&quot;4.1&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;zone</span> <span class="na">id=</span><span class="s">&quot;AS0&quot;</span> <span class="na">routing=</span><span class="s">&quot;Full&quot;</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- This host will be used by Batsim and won&#39;t be accounted. --&gt;</span>
        <span class="nt">&lt;host</span> <span class="na">id=</span><span class="s">&quot;master_host&quot;</span> <span class="na">pstate=</span><span class="s">&quot;0&quot;</span> <span class="na">speed=</span><span class="s">&quot;1000010.0Mf&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;prop</span> <span class="na">id=</span><span class="s">&quot;watt_per_state&quot;</span> <span class="na">value=</span><span class="s">&quot;95.0:190.1&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;prop</span> <span class="na">id=</span><span class="s">&quot;watt_off&quot;</span> <span class="na">value=</span><span class="s">&quot;9&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/host&gt;</span>

        <span class="c">&lt;!-- These hosts will be used to compute jobs. --&gt;</span>
        <span class="nt">&lt;host</span> <span class="na">id=</span><span class="s">&quot;0&quot;</span> <span class="na">pstate=</span><span class="s">&quot;1&quot;</span> <span class="na">speed=</span><span class="s">&quot;0.0f, 1000010.0f, 1.0001f, 0.1001&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;prop</span> <span class="na">id=</span><span class="s">&quot;watt_per_state&quot;</span> <span class="na">value=</span><span class="s">&quot;9:9,95.0:190.0,125.0:125.0,101.0:101.0&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;prop</span> <span class="na">id=</span><span class="s">&quot;sleep_pstates&quot;</span> <span class="na">value=</span><span class="s">&quot;0:3:2&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;prop</span> <span class="na">id=</span><span class="s">&quot;watt_off&quot;</span> <span class="na">value=</span><span class="s">&quot;9&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/host&gt;</span>
        <span class="nt">&lt;host</span> <span class="na">id=</span><span class="s">&quot;1&quot;</span> <span class="na">pstate=</span><span class="s">&quot;1&quot;</span> <span class="na">speed=</span><span class="s">&quot;0.0f, 1000010.0f, 1.0001f, 0.1001f&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;prop</span> <span class="na">id=</span><span class="s">&quot;watt_per_state&quot;</span> <span class="na">value=</span><span class="s">&quot;9:9,95.0:190.0,125.0:125.0,101.0:101.0&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;prop</span> <span class="na">id=</span><span class="s">&quot;sleep_pstates&quot;</span> <span class="na">value=</span><span class="s">&quot;0:3:2&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;prop</span> <span class="na">id=</span><span class="s">&quot;watt_off&quot;</span> <span class="na">value=</span><span class="s">&quot;9&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/host&gt;</span>
    <span class="nt">&lt;/zone&gt;</span>
<span class="nt">&lt;/platform&gt;</span>
</pre></div>
</div>
<p>To summarize the platform:</p>
<ul class="simple">
<li><p>We define a <strong>“master_host”</strong> (check the <code class="docutils literal notranslate"><span class="pre">id</span></code> attribute) to be used by Batsim. This host won’t be accounted in the simulation results (only Batsim can use this host).</p></li>
<li><p>For each host, in accordance with the <code class="docutils literal notranslate"><span class="pre">sleep_pstates</span></code> property, we define 4 power states:</p>
<ul>
<li><p>The power state (<strong>0</strong>) determines the power consumption while the host is <strong>sleeping</strong>, which is 9 Watts (W).</p></li>
<li><p>The power state (<strong>1</strong>) determines the power consumption while the host is <strong>idle</strong> or <strong>computing</strong>, which is 95 W while idle and 190 W while computing.</p></li>
<li><p>The power state (<strong>2</strong>) determines the power consumption while the host is <strong>switching on</strong> (boot), which is 125 W.</p></li>
<li><p>The power state (<strong>3</strong>) determines the power consumption while the host is <strong>switching off</strong> (shutdown), which is 101 W.</p></li>
</ul>
</li>
<li><p>Each power state also defines a speed (flop/s) that determines the time a job will take to finish and the time required to completely shutdown or boot up. Example:</p>
<ul>
<li><p>The <strong>switching off</strong> power state (3) has a speed of 0.1001 flops. Thus, the host takes <span class="math notranslate nohighlight">\(\frac{1}{0.1001} = \approx 10\)</span> seconds to shutdown.</p></li>
<li><p>The <strong>switching on</strong> power state (2) has a speed of 1.0001 flops. Thus, the host takes <span class="math notranslate nohighlight">\(\frac{1}{1.0001} = \approx 1\)</span> second to boot.</p></li>
<li><p>The <strong>computing</strong> power state (1) has a speed of 1000010.0 flops. Thus, if the host is allocated for a job that computes 2Mf, the job will take <span class="math notranslate nohighlight">\(\frac{2000000}{1000010} = \approx 1.99\)</span> seconds to complete.</p></li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title fa fa-exclamation-circle"><strong>Note</strong></p>
<p>When a host is switching On/Off, Batsim automatically starts a job that computes 1 flop in order to simulate the time and costs related to the transition between states. Thus, the speed defined in each transition power state determines the required time to switch.</p>
</div>
</div>
<div class="section" id="1.2.-Workload-Description">
<h3>1.2. Workload Description<a class="headerlink" href="#1.2.-Workload-Description" title="Permalink to this headline">¶</a></h3>
<p>After describing the platform, we must specify the workload. Let’s define a simple workload of 3 jobs and 2 simples profiles with CPU usage only.</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;nb_res&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="nt">&quot;jobs&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
            <span class="nt">&quot;res&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="nt">&quot;subtime&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="nt">&quot;walltime&quot;</span><span class="p">:</span> <span class="mi">240</span><span class="p">,</span>
            <span class="nt">&quot;profile&quot;</span><span class="p">:</span> <span class="s2">&quot;20&quot;</span><span class="p">,</span>
            <span class="nt">&quot;user_id&quot;</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span>
            <span class="nt">&quot;res&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="nt">&quot;subtime&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="nt">&quot;walltime&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
            <span class="nt">&quot;profile&quot;</span><span class="p">:</span> <span class="s2">&quot;120&quot;</span><span class="p">,</span>
            <span class="nt">&quot;user_id&quot;</span><span class="p">:</span> <span class="mi">1</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span>
            <span class="nt">&quot;res&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="nt">&quot;subtime&quot;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
            <span class="nt">&quot;walltime&quot;</span><span class="p">:</span> <span class="mi">240</span><span class="p">,</span>
            <span class="nt">&quot;profile&quot;</span><span class="p">:</span> <span class="s2">&quot;120&quot;</span><span class="p">,</span>
            <span class="nt">&quot;user_id&quot;</span><span class="p">:</span> <span class="mi">1</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="nt">&quot;profiles&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;120&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;cpu&quot;</span><span class="p">:</span> <span class="mi">120000000</span><span class="p">,</span>
            <span class="nt">&quot;com&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;parallel_homogeneous&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;20&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;cpu&quot;</span><span class="p">:</span> <span class="mi">20000000</span><span class="p">,</span>
            <span class="nt">&quot;com&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;parallel_homogeneous&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To summarize the workload:</p>
<ul class="simple">
<li><p>We define 3 jobs to be submitted in different simulation times (1, 3 and 24 seconds).</p></li>
<li><p>We define 2 profiles to specify how many flops/s (<code class="docutils literal notranslate"><span class="pre">CPU</span></code>) the job will compute on each requested hosts (20 Mf and 120 Mf).</p></li>
</ul>
</div>
</div>
<div class="section" id="2.-Shutdown-Policy">
<h2>2. Shutdown Policy<a class="headerlink" href="#2.-Shutdown-Policy" title="Permalink to this headline">¶</a></h2>
<p>In this tutorial, we’ll implement a simple Timeout Policy that turns off hosts if a period (<span class="math notranslate nohighlight">\(t\)</span>) of idleness is witnessed. Thus, if a host remains idle for <span class="math notranslate nohighlight">\(t\)</span> seconds, we turn it off to save energy.</p>
<p>Check the code below:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">batsim_py</span> <span class="kn">import</span> <span class="n">SimulatorHandler</span>
<span class="kn">from</span> <span class="nn">batsim_py.events</span> <span class="kn">import</span> <span class="n">HostEvent</span><span class="p">,</span> <span class="n">SimulatorEvent</span>
<span class="kn">from</span> <span class="nn">batsim_py.resources</span> <span class="kn">import</span> <span class="n">Host</span>

<span class="k">class</span> <span class="nc">TimeoutPolicy</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t_timeout</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">simulator</span><span class="p">:</span> <span class="n">SimulatorHandler</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simulator</span> <span class="o">=</span> <span class="n">simulator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t_timeout</span> <span class="o">=</span> <span class="n">t_timeout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hosts_idle</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Subscribe to some events.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simulator</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">SimulatorEvent</span><span class="o">.</span><span class="n">SIMULATION_BEGINS</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_simulation_begins</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simulator</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">HostEvent</span><span class="o">.</span><span class="n">STATE_CHANGED</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_host_state_changed</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">on_simulation_begins</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="n">SimulatorHandler</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">host</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">hosts</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">host</span><span class="o">.</span><span class="n">is_idle</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hosts_idle</span><span class="p">[</span><span class="n">host</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">current_time</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setup_callback</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">on_host_state_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="p">:</span> <span class="n">Host</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">h</span><span class="o">.</span><span class="n">is_idle</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">h</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hosts_idle</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hosts_idle</span><span class="p">[</span><span class="n">h</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulator</span><span class="o">.</span><span class="n">current_time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup_callback</span><span class="p">()</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">h</span><span class="o">.</span><span class="n">is_idle</span> <span class="ow">and</span> <span class="n">h</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hosts_idle</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">hosts_idle</span><span class="p">[</span><span class="n">h</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">setup_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">t_next_call</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulator</span><span class="o">.</span><span class="n">current_time</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_timeout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simulator</span><span class="o">.</span><span class="n">set_callback</span><span class="p">(</span><span class="n">t_next_call</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">host_id</span><span class="p">,</span> <span class="n">t_idle_start</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hosts_idle</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">if</span>  <span class="n">current_time</span> <span class="o">-</span> <span class="n">t_idle_start</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_timeout</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">simulator</span><span class="o">.</span><span class="n">switch_off</span><span class="p">([</span><span class="n">host_id</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p>We follow an event-based design and the Timeout Policy will act in response to certain events. When the simulation begins, we record the current time for each idle host and set up a callback to be called after <code class="docutils literal notranslate"><span class="pre">t_timeout</span></code> seconds. If nothing happens until the callback is called, we switch off hosts that remain idle. Otherwise, if a host switches its state (which dispatches an event) and is no longer idle, we just delete it from our records (<code class="docutils literal notranslate"><span class="pre">hosts_idle</span></code>). The same applies if a host becomes
idle, an event is dispatched and we record the current time to set up the callback again.</p>
</div>
<div class="section" id="3.-Simulation-Process">
<h2>3. Simulation Process<a class="headerlink" href="#3.-Simulation-Process" title="Permalink to this headline">¶</a></h2>
<p>After defining the simulation inputs and the shutdown policies we want to evaluate, it’s time to run the simulation and collect some results.</p>
<p>Check the code below:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">batsim_py</span> <span class="kn">import</span> <span class="n">SimulatorHandler</span>
<span class="kn">from</span> <span class="nn">batsim_py.monitors</span> <span class="kn">import</span> <span class="n">SimulationMonitor</span><span class="p">,</span> <span class="n">HostStateSwitchMonitor</span><span class="p">,</span> <span class="n">ConsumedEnergyMonitor</span>

<span class="k">def</span> <span class="nf">run_simulation</span><span class="p">(</span><span class="n">shutdown_policy</span><span class="p">):</span>
    <span class="n">simulator</span> <span class="o">=</span> <span class="n">SimulatorHandler</span><span class="p">()</span>
    <span class="n">policy</span> <span class="o">=</span> <span class="n">shutdown_policy</span><span class="p">(</span><span class="n">simulator</span><span class="p">)</span>

    <span class="c1"># 1) Instantiate monitors to collect simulation statistics</span>
    <span class="n">sim_mon</span> <span class="o">=</span> <span class="n">SimulationMonitor</span><span class="p">(</span><span class="n">simulator</span><span class="p">)</span>
    <span class="n">host_mon</span> <span class="o">=</span> <span class="n">HostStateSwitchMonitor</span><span class="p">(</span><span class="n">simulator</span><span class="p">)</span>
    <span class="n">e_mon</span> <span class="o">=</span> <span class="n">ConsumedEnergyMonitor</span><span class="p">(</span><span class="n">simulator</span><span class="p">)</span>

    <span class="c1"># 2) Start simulation</span>
    <span class="n">simulator</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">platform</span><span class="o">=</span><span class="s2">&quot;platforms/energy_hosts_2.xml&quot;</span><span class="p">,</span>
                    <span class="n">workload</span><span class="o">=</span><span class="s2">&quot;workloads/w_shutdown.json&quot;</span><span class="p">,</span>
                    <span class="n">verbosity</span><span class="o">=</span><span class="s2">&quot;information&quot;</span><span class="p">)</span>

    <span class="c1"># 3) Schedule all jobs</span>
    <span class="k">while</span> <span class="n">simulator</span><span class="o">.</span><span class="n">is_running</span><span class="p">:</span>
        <span class="c1"># First Fit policy</span>
        <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="n">simulator</span><span class="o">.</span><span class="n">queue</span><span class="p">:</span>
            <span class="n">available</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">get_not_allocated_hosts</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">res</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">available</span><span class="p">):</span>
                <span class="n">allocation</span> <span class="o">=</span> <span class="p">[</span><span class="n">h</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">available</span><span class="p">[:</span><span class="n">job</span><span class="o">.</span><span class="n">res</span><span class="p">]]</span>
                <span class="n">simulator</span><span class="o">.</span><span class="n">allocate</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">allocation</span><span class="p">)</span>

        <span class="c1"># proceed directly to the next event because the shutdown_policy is event-based.</span>
        <span class="n">simulator</span><span class="o">.</span><span class="n">proceed_time</span><span class="p">()</span>

    <span class="n">simulator</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># 4) Return/Dump statistics</span>
    <span class="k">return</span> <span class="n">sim_mon</span><span class="p">,</span> <span class="n">host_mon</span><span class="p">,</span> <span class="n">e_mon</span>

<span class="n">sim_none</span><span class="p">,</span> <span class="n">host_none</span><span class="p">,</span> <span class="n">e_none</span> <span class="o">=</span> <span class="n">run_simulation</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span> <span class="c1"># Without shutdown</span>
<span class="n">sim_t1</span><span class="p">,</span> <span class="n">host_t1</span><span class="p">,</span> <span class="n">e_t1</span> <span class="o">=</span> <span class="n">run_simulation</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">TimeoutPolicy</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span> <span class="c1"># Timeout (1)</span>
<span class="n">sim_t5</span><span class="p">,</span> <span class="n">host_t5</span><span class="p">,</span> <span class="n">e_t5</span> <span class="o">=</span> <span class="n">run_simulation</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">TimeoutPolicy</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span> <span class="c1"># Timeout (5)</span>
</pre></div>
</div>
</div>
<p>To evaluate the effectiveness of a shutdown policy, we run three different experiments: without shutdown policy; with a timeout policy that turns off hosts that remain idle for more than a second; and a timeout policy that turns off hosts that remain idle for more than 5 seconds.</p>
<p>The simulation process follows the same approach adopted in the <a class="reference internal" href="scheduling.html"><span class="doc">Scheduling tutorial</span></a> with minor changes. The timeout policy does not exclude the need for a scheduler. To this end, we adopted the First-Fit policy and every job that fits in the number of available resources will immediately start.</p>
</div>
<div class="section" id="4.-Results-Discussion">
<h2>4. Results Discussion<a class="headerlink" href="#4.-Results-Discussion" title="Permalink to this headline">¶</a></h2>
<p>We start the discussion by checking the overall performance, check the code below:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="c1"># Read results</span>
<span class="n">none</span><span class="p">,</span> <span class="n">t_1</span><span class="p">,</span> <span class="n">t_5</span> <span class="o">=</span> <span class="n">sim_none</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">(),</span> <span class="n">sim_t1</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">(),</span> <span class="n">sim_t5</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
<span class="n">none</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">t_1</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">t_5</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="s2">&quot;Timeout (1)&quot;</span><span class="p">,</span> <span class="s2">&quot;Timeout (5)&quot;</span>
<span class="n">benchmark</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">none</span><span class="p">,</span> <span class="n">t_1</span><span class="p">,</span> <span class="n">t_5</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Slowdown</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;mean_slowdown&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">benchmark</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Averaged Slowdown (s)&quot;</span><span class="p">)</span>

<span class="c1"># Energy consumed</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;consumed_joules&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">benchmark</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Energy Consumed (J)&quot;</span><span class="p">)</span>

<span class="c1"># Show</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_shutdown_24_0.png" src="../_images/tutorials_shutdown_24_0.png" />
</div>
</div>
<p>Considering the averaged slowdown, both the experiment with the Timeout (5) policy and the experiment without a policy gave the same results. We can also observe that the Timeout (1) policy significantly increased the slowdown by <span class="math notranslate nohighlight">\(24\%\)</span>.</p>
<p>Considering the amount of energy consumed, the Timeout (5) policy achieved the best results. With this policy, we were able to minimize the consumption by <span class="math notranslate nohighlight">\(4.7\%\)</span> in comparison to the experiment that does not use a shutdown policy. Moreover, although the Timeout (5) policy needs more time to turn off hosts, it was better than the Timeout (1) policy by <span class="math notranslate nohighlight">\(2\%\)</span>. The reason behind this is related to the cost of switching On/Off, which consumes both energy and time.</p>
<p>To better understand these results, we can also use the <a class="reference external" href="https://pypi.org/project/evalys/">evalys package</a> to plot some charts, check the code below:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">evalys.mstates</span> <span class="kn">import</span> <span class="n">MachineStatesChanges</span>
<span class="kn">from</span> <span class="nn">evalys.visu.legacy</span> <span class="kn">import</span> <span class="n">plot_mstates</span>

<span class="c1"># Convert monitors to dataframes</span>
<span class="n">none</span><span class="p">,</span> <span class="n">t_1</span><span class="p">,</span> <span class="n">t_5</span> <span class="o">=</span> <span class="n">host_none</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">(),</span> <span class="n">host_t1</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">(),</span> <span class="n">host_t5</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>

<span class="c1"># Plot</span>
<span class="n">_</span><span class="p">,</span> <span class="n">ax_list</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plot_mstates</span><span class="p">(</span><span class="n">none</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Resources state: Without Shutdown Policy&quot;</span><span class="p">)</span>
<span class="n">plot_mstates</span><span class="p">(</span><span class="n">t_1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Resources state: Timeout (1)&quot;</span><span class="p">)</span>
<span class="n">ax_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
<span class="n">plot_mstates</span><span class="p">(</span><span class="n">t_5</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax_list</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Resources state: Timeout (5)&quot;</span><span class="p">)</span>



<span class="c1"># Show</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="mi">160</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_shutdown_26_0.png" src="../_images/tutorials_shutdown_26_0.png" />
</div>
</div>
<p>Looking at the chart, it becomes clear that the shutdown of hosts at time 1 was costly for the Timeout (1) policy. A job was submitted just after the host was turned off, forcing it to boot up right after. If we could know that this would happen, we could overcome this situation but obtaining such information is not straightforward. In this case, it may be worth waiting a little longer before shutting down the hosts.</p>
<p>To clarify further, we can also plot the power consumption over time. Check the code below:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="n">dataframe</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;energy&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">diff</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span><span class="s1">&#39;time_diff&#39;</span><span class="p">,</span> <span class="s1">&#39;energy&#39;</span><span class="p">:</span><span class="s1">&#39;energy_diff&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">concat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">diff</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">concat</span><span class="p">[</span><span class="s1">&#39;power&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">concat</span><span class="p">[</span><span class="s1">&#39;energy_diff&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">concat</span><span class="p">[</span><span class="s1">&#39;time_diff&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">concat</span>

<span class="c1"># Convert monitors to dataframes</span>
<span class="n">none</span><span class="p">,</span> <span class="n">t_1</span><span class="p">,</span> <span class="n">t_5</span> <span class="o">=</span> <span class="n">e_none</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">(),</span> <span class="n">e_t1</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">(),</span> <span class="n">e_t5</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>

<span class="c1"># Prepare data</span>
<span class="n">none</span><span class="p">,</span> <span class="n">t_1</span><span class="p">,</span> <span class="n">t_5</span> <span class="o">=</span> <span class="n">prepare</span><span class="p">(</span><span class="n">none</span><span class="p">),</span> <span class="n">prepare</span><span class="p">(</span><span class="n">t_1</span><span class="p">),</span> <span class="n">prepare</span><span class="p">(</span><span class="n">t_5</span><span class="p">)</span>

<span class="c1"># Plot</span>
<span class="n">_</span><span class="p">,</span> <span class="n">ax_list</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">none</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">none</span><span class="p">[</span><span class="s1">&#39;power&#39;</span><span class="p">],</span> <span class="n">drawstyle</span><span class="o">=</span><span class="s1">&#39;steps-pre&#39;</span><span class="p">)</span>
<span class="n">ax_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Without Shutdown Policy&#39;</span><span class="p">)</span>

<span class="n">ax_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_1</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">t_1</span><span class="p">[</span><span class="s1">&#39;power&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Power (W)&quot;</span><span class="p">,</span> <span class="n">drawstyle</span><span class="o">=</span><span class="s1">&#39;steps-pre&#39;</span><span class="p">)</span>
<span class="n">ax_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Timeout (1)&#39;</span><span class="p">)</span>
<span class="n">ax_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>

<span class="n">ax_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_5</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">t_5</span><span class="p">[</span><span class="s1">&#39;power&#39;</span><span class="p">],</span> <span class="n">drawstyle</span><span class="o">=</span><span class="s1">&#39;steps-pre&#39;</span><span class="p">)</span>
<span class="n">ax_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Timeout (5)&#39;</span><span class="p">)</span>


<span class="c1"># Show</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="mi">160</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_shutdown_28_0.png" src="../_images/tutorials_shutdown_28_0.png" />
</div>
</div>
</div>
<div class="section" id="Next-Steps">
<h2>Next Steps<a class="headerlink" href="#Next-Steps" title="Permalink to this headline">¶</a></h2>
<p>This tutorial is a very simple example of how to evaluate shutdown policies. Neither the platform nor the workload were realistic. So, as the next steps, you can extend this tutorial to cover other policies, workloads, and platforms.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="dvfs.html" class="btn btn-neutral float-right" title="DVFS" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="scheduling.html" class="btn btn-neutral float-left" title="Scheduling" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Lucas C. Casagrande

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>